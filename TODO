-*- org -*-   

* DONE implement xpath custom handlers
* [8/9] code review (compare C to FFI side by side)
  - [X] xml/node.rb
  - [X] xml/document.rb
  - [X] xml/node_set.rb
  - [X] xml/xpath_context.rb
  - [X] xml/cdata.rb
  - [X] html/document.rb
  - [X] html/entity_lookup.rb
  - [X] reader.rb
  - [ ] xslt.rb, xslt/stylesheet.rb
* DONE code review of function prototypes
* [7/7] implement classes:
  - [X] HTML::ElementDescription
  - [X] XML::Schema
  - [X] HTML::EntityLookup
  - [X] XML::EntityReference
  - [X] XML::RelaxNG
  - [X] SAX::PushParser
  - [X] ProcessingInstruction
* miscellaneous issues
*** TODO blanks being escaped in output
    - test/xml/test_unparented_node.rb:58:in `test_write_html_to'
    - test/xml/test_unparented_node.rb:58:in `test_write_xhtml_to'
    - test/xml/test_node.rb:153:in `test_write_html_to'
    - test/xml/test_node.rb:153:in `test_write_xhtml_to'
*** TODO heisenbug:
test_attribute_roundtrip(TestReader):
NoMethodError: undefined method `attribute_nodes' for [-617503368]:Array
    /home/mike/code/nokogiri/lib/nokogiri/ffi/xml/reader.rb:42:in `attribute_nodes'
    /home/mike/code/nokogiri/lib/nokogiri/xml/reader.rb:14:in `attributes'
    ./test/test_reader.rb:81:in `test_attribute_roundtrip'
    /home/mike/code/nokogiri/lib/nokogiri/xml/reader.rb:21:in `call'
    /home/mike/code/nokogiri/lib/nokogiri/xml/reader.rb:21:in `each'
    ./test/test_reader.rb:80:in `test_attribute_roundtrip'
    /usr/lib/ruby/gems/1.8/gems/mocha-0.9.3/lib/mocha/test_case_adapter.rb:69:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/mocha-0.9.3/lib/mocha/test_case_adapter.rb:69:in `run'

test_attributes(TestReader):
RangeError: 0xdb387178 is recycled object
    /home/mike/code/nokogiri/lib/nokogiri/ffi/structs/common_node.rb:15:in `_id2ref'
    /home/mike/code/nokogiri/lib/nokogiri/ffi/structs/common_node.rb:15:in `ruby_node'
    /home/mike/code/nokogiri/lib/nokogiri/ffi/xml/node.rb:252:in `wrap'
    /home/mike/code/nokogiri/lib/nokogiri/ffi/xml/reader.rb:41:in `attribute_nodes'
    /home/mike/code/nokogiri/lib/nokogiri/xml/reader.rb:14:in `attributes'
    ./test/test_reader.rb:69:in `test_attributes'
    /home/mike/code/nokogiri/lib/nokogiri/xml/node.rb:288:in `map'
    /home/mike/code/nokogiri/lib/nokogiri/xml/reader.rb:21:in `call'
    /home/mike/code/nokogiri/lib/nokogiri/xml/reader.rb:21:in `each'
    ./test/test_reader.rb:69:in `map'
    ./test/test_reader.rb:69:in `test_attributes'
    /usr/lib/ruby/gems/1.8/gems/mocha-0.9.3/lib/mocha/test_case_adapter.rb:69:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/mocha-0.9.3/lib/mocha/test_case_adapter.rb:69:in `run'

* jruby-only bugs
*** DONE fucking annoying "warning: too many arguments for format string" messages everywhere
*** TODO lingering syntax error issues. try test/xml/test_document.rb
*** TODO how to lookup and find libxml2.so and libxslt.so?

* TODO convert structs to using layout() instead of FFI::Generator stubs
*** TODO then remove the 'rake ffi' task and supporting functions

* TODO open jira tickets: support varags in callbacks (needed for syntax error and sax error)
* figure out how to cache the ruby objects (nodes and documents) without using Objectspace.

* use (new) nested struct support in FFI?
* do we have string encoding issues?
* i feel like we should refactor reader/writer/closer io callbacks
* rdoc documentation? shit.
